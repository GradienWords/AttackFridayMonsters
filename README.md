# `Attack of the Friday Monsters!` Translation Tools

Tools for the Spanish fan-translation of the 3DS video-game: _Attack of the
Friday Monsters! A Tokyo Tale_. By
[GradienWords](https://gradienwords.github.io).

## Getting the tools

### Dependencies

These tools use different languages like C, C# and Python. To compile and use
them you need the following programs:

- CMake: >= 3.18.1
- [.NET Core SDK 3.1](https://dotnet.microsoft.com/download)
- Python: 3.8
- gcc / clang / Visual Studio
  - In Unix with C++ compile and static libstdc++

### Preparation

First, you need to compile and prepare the tools. Run the following commands in
a terminal:

```sh
mkdir GameData
cd Programs
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=<repo>/GameData
cmake --build . --target install --config Release -j

cd ../../
dotnet tool restore

python -m venv .env
.env/bin/activate # in windows it's in the Scripts folder
pip install pypng
```

## Export files

Run in a terminal:

```sh
.env/bin/activate # in windows it's in the Scripts folder
dotnet cake exporter.cake
```

Optional arguments:

- `--game=<path>` --> game file path in decrypted (non-legit) CIA format.
  Default value
  `GameData/00040000000E7500 Attack of the Friday Monsters! (CTR-N-JKEP) (E).cia`
  (default name from godmode9 dumps).

- `--output=<path>` --> output folder to write the text and images files.
  Default value `GameData/extracted`.

### Export code binary texts

To export the text from the `code.bin` file, the tool needs a YAML file
`code_text.yml` with the pointer and size of each text string in the binary. The
file is available in `Programs` and CMake will copy it to the `GameData/tools`
folder.

This file was generated by creating a Ghidra project with the `code.bin` file.
Then running the auto-analysis to find string texts and manually defining other
text data. Once all the data was located, the following Ghidra script generates
the YAML file.

```sh
<ghidra_installation>/support/analyzeHeadless <ghidra_project> <project_name> \
  -process code.bin \
  -postScript ./Programs/Ghidra/ExportDefinedStrings.java ./GameData/tools/code_texts.yaml \
  -noanalysis
```

Note: before importing the file `code.bin`, make sure it is decompressed with
the CUE tool `blz`.

## Import files

Run in a terminal:

```sh
.env/bin/activate # in windows it's in the Scripts folder
dotnet cake importer.cake
```

Optional arguments:

- `--game=<path>` --> game file path in decrypted (non-legit) CIA format.
  Default value
  `GameData/00040000000E7500 Attack of the Friday Monsters! (CTR-N-JKEP) (E).cia`
  (default name from godmode9 dumps).

- `--translation=<path>` --> folder with the modified / translated exported
  files. Default value `Spanish/es`.

- `--output=<path>` --> folder to write the modified RomFS, ExeFS and NCCH
  extended header. Default value `GameData/output`.

- `--layeredfs=<path>` --> folder to write the modified files for systems
  compatible with LayeredFS such as Luma and Citra. Default value
  `GameData/output/luma/titles` (the `luma` folder can be copied directly to the
  root of the SD to use it).

- `--copy-citra=true|false` --> copy the LayeredFS patch to the Citra mods
  folder of this computer. Default value `true`.

## Credits

- pleonex:
  - [Yarhl](https://github.com/SceneGate/yarhl)
  - [Lemon](https://github.com/SceneGate/Lemon)
  - Custom game converter and formats.
- CUE:
  - [blz and lzx (de)compressor](https://www.romhacking.net/utilities/826/).
- ObsidianX:
  - [Font tool](https://github.com/ObsidianX/3dstools)
- dnasdw:
  - [3DS generator](https://github.com/dnasdw/3dstool)
  - [bclim image tool](https://github.com/dnasdw/bclimtool)
  - [texture image tool](https://github.com/dnasdw/txobtool)
- jmacd:
  - [xdelta](https://github.com/jmacd/xdelta-gpl)
